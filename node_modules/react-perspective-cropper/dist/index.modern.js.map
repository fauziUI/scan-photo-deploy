{"version":3,"file":"index.modern.js","sources":["../src/lib/utils.js","../src/lib/CropPoint.js","../src/lib/CropPoints.js","../src/lib/imgManipulation.js","../src/lib/CropPointsDelimiters.js","../src/lib/Canvas.js","../src/components/Cropper.js"],"sourcesContent":["export const readFile = (file) => {\n  if (file instanceof File) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader()\n      reader.onload = (event) => {\n        resolve(reader.result)\n      }\n      reader.onerror = (err) => {\n        reject(err)\n      }\n      reader.readAsDataURL(file)\n    })\n  }\n  if (typeof file === 'string') {\n    return Promise.resolve(file)\n  }\n}\n\nexport const calcDims = (\n  width,\n  height,\n  externalMaxWidth,\n  externalMaxHeight\n) => {\n  const ratio = width / height\n\n  const maxWidth = externalMaxWidth || window.innerWidth\n  const maxHeight = externalMaxHeight || window.innerHeight\n  const calculated = {\n    width: maxWidth,\n    height: Math.round(maxWidth / ratio),\n    ratio: ratio\n  }\n\n  if (calculated.height > maxHeight) {\n    calculated.height = maxHeight\n    calculated.width = Math.round(maxHeight * ratio)\n  }\n  return calculated\n}\n","import React, { useCallback } from 'react'\nimport Draggable from 'react-draggable'\nimport T from 'prop-types'\n\nconst buildCropPointStyle = (size, pointBgColor, pointBorder) => ({\n  width: size,\n  height: size,\n  backgroundColor: pointBgColor,\n  border: pointBorder,\n  borderRadius: '100%',\n  position: 'absolute',\n  zIndex: 1001\n})\n\nconst CropPoint = ({\n  cropPoints,\n  pointArea,\n  defaultPosition,\n  pointSize,\n  pointBgColor = 'transparent',\n  pointBorder = '4px solid #3cabe2',\n  onStop: externalOnStop,\n  onDrag: externalOnDrag,\n  bounds\n}) => {\n  const onDrag = useCallback(\n    (_, position) => {\n      externalOnDrag(\n        {\n          ...position,\n          x: position.x + pointSize / 2,\n          y: position.y + pointSize / 2\n        },\n        pointArea\n      )\n    },\n    [externalOnDrag]\n  )\n\n  const onStop = useCallback(\n    (_, position) => {\n      externalOnStop(\n        {\n          ...position,\n          x: position.x + pointSize / 2,\n          y: position.y + pointSize / 2\n        },\n        pointArea,\n        cropPoints\n      )\n    },\n    [externalOnDrag, cropPoints]\n  )\n\n  return (\n    <Draggable\n      bounds={bounds}\n      defaultPosition={defaultPosition}\n      position={{\n        x: cropPoints[pointArea].x - pointSize / 2,\n        y: cropPoints[pointArea].y - pointSize / 2\n      }}\n      onDrag={onDrag}\n      onStop={onStop}\n    >\n      <div style={buildCropPointStyle(pointSize, pointBgColor, pointBorder)} />\n    </Draggable>\n  )\n}\n\nexport default CropPoint\n\nCropPoint.propTypes = {\n  cropPoints: T.shape({\n    'left-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-bottom': T.shape({ x: T.number, y: T.number }).isRequired,\n    'left-bottom': T.shape({ x: T.number, y: T.number }).isRequired\n  }),\n  pointArea: T.oneOf(['left-top', 'right-top', 'right-bottom', 'left-bottom']),\n  defaultPosition: T.shape({\n    x: T.number,\n    y: T.number\n  }),\n  pointSize: T.number,\n  pointBgColor: T.string,\n  pointBorder: T.string,\n  onStop: T.func,\n  onDrag: T.func\n}\n","import React, { Fragment } from 'react'\nimport CropPoint from './CropPoint'\nimport T from 'prop-types'\n\nconst CropPoints = (props) => {\n  const { previewDims, ...otherProps } = props\n  return (\n    <>\n      <CropPoint\n        pointArea='left-top'\n        defaultPosition={{ x: 0, y: 0 }}\n        {...otherProps}\n      />\n      <CropPoint\n        pointArea='right-top'\n        defaultPosition={{ x: previewDims.width, y: 0 }}\n        {...otherProps}\n      />\n      <CropPoint\n        pointArea='right-bottom'\n        defaultPosition={{ x: 0, y: previewDims.height }}\n        {...otherProps}\n      />\n      <CropPoint\n        pointArea='left-bottom'\n        defaultPosition={{\n          x: previewDims.width,\n          y: previewDims.height\n        }}\n        {...otherProps}\n      />\n    </>\n  )\n}\n\nexport default CropPoints\n\nCropPoints.propTypes = {\n  previewDims: T.shape({\n    ratio: T.number,\n    width: T.number,\n    height: T.number\n  })\n}\n","export const transform = (\n  cv,\n  docCanvas,\n  cropPoints,\n  imageResizeRatio,\n  setPreviewPaneDimensions\n) => {\n  const dst = cv.imread(docCanvas)\n\n  const bR = cropPoints['right-bottom']\n  const bL = cropPoints['left-bottom']\n  const tR = cropPoints['right-top']\n  const tL = cropPoints['left-top']\n\n  // create source coordinates matrix\n  const sourceCoordinates = [tL, tR, bR, bL].map((point) => [\n    point.x / imageResizeRatio,\n    point.y / imageResizeRatio\n  ])\n\n  // get max width\n  const maxWidth = Math.max(bR.x - bL.x, tR.x - tL.x) / imageResizeRatio\n  // get max height\n  const maxHeight = Math.max(bL.y - tL.y, bR.y - tR.y) / imageResizeRatio\n\n  // create dest coordinates matrix\n  const destCoordinates = [\n    [0, 0],\n    [maxWidth - 1, 0],\n    [maxWidth - 1, maxHeight - 1],\n    [0, maxHeight - 1]\n  ]\n\n  // convert to open cv matrix objects\n  const Ms = cv.matFromArray(4, 1, cv.CV_32FC2, [].concat(...sourceCoordinates))\n  const Md = cv.matFromArray(4, 1, cv.CV_32FC2, [].concat(...destCoordinates))\n  const transformMatrix = cv.getPerspectiveTransform(Ms, Md)\n  // set new image size\n  const dsize = new cv.Size(maxWidth, maxHeight)\n  // perform warp\n  cv.warpPerspective(\n    dst,\n    dst,\n    transformMatrix,\n    dsize,\n    cv.INTER_LINEAR,\n    cv.BORDER_CONSTANT,\n    new cv.Scalar()\n  )\n  cv.imshow(docCanvas, dst)\n\n  dst.delete()\n  Ms.delete()\n  Md.delete()\n  transformMatrix.delete()\n\n  setPreviewPaneDimensions()\n}\n\nexport const applyFilter = async (cv, docCanvas, filterCvParams) => {\n  // default options\n  const options = {\n    blur: false,\n    th: true,\n    thMode: cv.ADAPTIVE_THRESH_MEAN_C,\n    thMeanCorrection: 15,\n    thBlockSize: 25,\n    thMax: 255,\n    grayScale: true,\n    ...filterCvParams\n  }\n  const dst = cv.imread(docCanvas)\n\n  if (options.grayScale) {\n    cv.cvtColor(dst, dst, cv.COLOR_RGBA2GRAY, 0)\n  }\n  if (options.blur) {\n    const ksize = new cv.Size(5, 5)\n    cv.GaussianBlur(dst, dst, ksize, 0, 0, cv.BORDER_DEFAULT)\n  }\n  if (options.th) {\n    if (options.grayScale) {\n      cv.adaptiveThreshold(\n        dst,\n        dst,\n        options.thMax,\n        options.thMode,\n        cv.THRESH_BINARY,\n        options.thBlockSize,\n        options.thMeanCorrection\n      )\n    } else {\n      dst.convertTo(dst, -1, 1, 60)\n      cv.threshold(dst, dst, 170, 255, cv.THRESH_BINARY)\n    }\n  }\n  cv.imshow(docCanvas, dst)\n}\n","import React, { useCallback, useEffect, useRef } from 'react'\nimport T from 'prop-types'\n\nconst CropPointsDelimiters = ({\n  cropPoints,\n  previewDims,\n  lineWidth = 3,\n  lineColor = '#3cabe2',\n  pointSize\n}) => {\n  const canvas = useRef()\n\n  const clearCanvas = useCallback(() => {\n    const ctx = canvas.current.getContext('2d')\n    ctx.clearRect(0, 0, previewDims.width, previewDims.height)\n  }, [canvas.current, previewDims])\n\n  const sortPoints = useCallback(() => {\n    const sortOrder = ['left-top', 'right-top', 'right-bottom', 'left-bottom']\n    return sortOrder.reduce(\n      (acc, pointPos) => [...acc, cropPoints[pointPos]],\n      []\n    )\n  }, [cropPoints])\n\n  const drawShape = useCallback(\n    ([point1, point2, point3, point4]) => {\n      const ctx = canvas.current.getContext('2d')\n      ctx.lineWidth = lineWidth\n      ctx.strokeStyle = lineColor\n\n      ctx.beginPath()\n      ctx.moveTo(point1.x + pointSize / 2, point1.y)\n      ctx.lineTo(point2.x - pointSize / 2, point2.y)\n\n      ctx.moveTo(point2.x, point2.y + pointSize / 2)\n      ctx.lineTo(point3.x, point3.y - pointSize / 2)\n\n      ctx.moveTo(point3.x - pointSize / 2, point3.y)\n      ctx.lineTo(point4.x + pointSize / 2, point4.y)\n\n      ctx.moveTo(point4.x, point4.y - pointSize / 2)\n      ctx.lineTo(point1.x, point1.y + pointSize / 2)\n      ctx.closePath()\n      ctx.stroke()\n    },\n    [canvas.current]\n  )\n\n  useEffect(() => {\n    if (cropPoints && canvas.current) {\n      clearCanvas()\n      const sortedPoints = sortPoints()\n      drawShape(sortedPoints)\n    }\n  }, [cropPoints, canvas.current])\n\n  return (\n    <canvas\n      ref={canvas}\n      style={{\n        position: 'absolute',\n        zIndex: 5\n      }}\n      width={previewDims.width}\n      height={previewDims.height}\n    />\n  )\n}\n\nexport default CropPointsDelimiters\n\nCropPointsDelimiters.propTypes = {\n  previewDims: T.shape({\n    ratio: T.number,\n    width: T.number,\n    height: T.number\n  }),\n  cropPoints: T.shape({\n    'left-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-bottom': T.shape({ x: T.number, y: T.number }).isRequired,\n    'left-bottom': T.shape({ x: T.number, y: T.number }).isRequired\n  }),\n  lineColor: T.string,\n  lineWidth: T.number,\n  pointSize: T.number\n}\n","import React, {\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n  Fragment\n} from 'react'\nimport { useOpenCv } from 'opencv-react'\nimport T from 'prop-types'\n\nimport { calcDims, readFile } from '../lib/utils'\nimport CropPoints from '../lib/CropPoints'\nimport { applyFilter, transform } from '../lib/imgManipulation'\nimport CropPointsDelimiters from './CropPointsDelimiters'\n\nconst buildImgContainerStyle = (previewDims) => ({\n  width: previewDims.width,\n  height: previewDims.height\n})\n\nconst imageDimensions = { width: 0, height: 0 }\nlet imageResizeRatio\n\nconst Canvas = ({\n  image,\n  onDragStop,\n  onChange,\n  cropperRef,\n  pointSize = 30,\n  lineWidth,\n  pointBgColor,\n  pointBorder,\n  lineColor,\n  maxWidth,\n  maxHeight\n}) => {\n  const { loaded: cvLoaded, cv } = useOpenCv()\n  const canvasRef = useRef()\n  const previewCanvasRef = useRef()\n  const magnifierCanvasRef = useRef()\n  const [previewDims, setPreviewDims] = useState()\n  const [cropPoints, setCropPoints] = useState()\n  const [loading, setLoading] = useState(false)\n  const [mode, setMode] = useState('crop')\n\n  useImperativeHandle(cropperRef, () => ({\n    backToCrop: () => {\n      setMode('crop')\n    },\n    done: async (opts = {}) => {\n      return new Promise((resolve) => {\n        setLoading(true)\n        transform(\n          cv,\n          canvasRef.current,\n          cropPoints,\n          imageResizeRatio,\n          setPreviewPaneDimensions\n        )\n        applyFilter(cv, canvasRef.current, opts.filterCvParams)\n        if (opts.preview) {\n          setMode('preview')\n        }\n        canvasRef.current.toBlob((blob) => {\n          blob.name = image.name\n          resolve(blob)\n          setLoading(false)\n        }, image.type)\n      })\n    }\n  }))\n\n  useEffect(() => {\n    if (mode === 'preview') {\n      showPreview()\n    }\n  }, [mode])\n\n  const setPreviewPaneDimensions = () => {\n    // set preview pane dimensions\n    const newPreviewDims = calcDims(\n      canvasRef.current.width,\n      canvasRef.current.height,\n      maxWidth,\n      maxHeight\n    )\n    setPreviewDims(newPreviewDims)\n\n    previewCanvasRef.current.width = newPreviewDims.width\n    previewCanvasRef.current.height = newPreviewDims.height\n\n    imageResizeRatio = newPreviewDims.width / canvasRef.current.width\n  }\n\n  const createCanvas = (src) => {\n    return new Promise((resolve, reject) => {\n      const img = document.createElement('img')\n      img.onload = async () => {\n        // set edited image canvas and dimensions\n        canvasRef.current = document.createElement('canvas')\n        canvasRef.current.width = img.width\n        canvasRef.current.height = img.height\n        const ctx = canvasRef.current.getContext('2d')\n        ctx.drawImage(img, 0, 0)\n        imageDimensions.width = canvasRef.current.width\n        imageDimensions.height = canvasRef.current.height\n        setPreviewPaneDimensions()\n        resolve()\n      }\n      img.src = src\n    })\n  }\n\n  const showPreview = (image) => {\n    const src = image || cv.imread(canvasRef.current)\n    const dst = new cv.Mat()\n    const dsize = new cv.Size(0, 0)\n    cv.resize(\n      src,\n      dst,\n      dsize,\n      imageResizeRatio,\n      imageResizeRatio,\n      cv.INTER_AREA\n    )\n    cv.imshow(previewCanvasRef.current, dst)\n    src.delete()\n    dst.delete()\n  }\n\n  const detectContours = () => {\n    const dst = cv.imread(canvasRef.current)\n    const ksize = new cv.Size(5, 5)\n    // convert the image to grayscale, blur it, and find edges in the image\n    cv.cvtColor(dst, dst, cv.COLOR_RGBA2GRAY, 0)\n    cv.GaussianBlur(dst, dst, ksize, 0, 0, cv.BORDER_DEFAULT)\n    cv.Canny(dst, dst, 75, 200)\n    // find contours\n    cv.threshold(dst, dst, 120, 200, cv.THRESH_BINARY)\n    const contours = new cv.MatVector()\n    const hierarchy = new cv.Mat()\n    cv.findContours(\n      dst,\n      contours,\n      hierarchy,\n      cv.RETR_CCOMP,\n      cv.CHAIN_APPROX_SIMPLE\n    )\n    const rect = cv.boundingRect(dst)\n    dst.delete()\n    hierarchy.delete()\n    contours.delete()\n    // transform the rectangle into a set of points\n    Object.keys(rect).forEach((key) => {\n      rect[key] = rect[key] * imageResizeRatio\n    })\n\n    const contourCoordinates = {\n      'left-top': { x: rect.x, y: rect.y },\n      'right-top': { x: rect.x + rect.width, y: rect.y },\n      'right-bottom': {\n        x: rect.x + rect.width,\n        y: rect.y + rect.height\n      },\n      'left-bottom': { x: rect.x, y: rect.y + rect.height }\n    }\n\n    setCropPoints(contourCoordinates)\n  }\n\n  const clearMagnifier = () => {\n    const magnCtx = magnifierCanvasRef.current.getContext('2d')\n    magnCtx.clearRect(\n      0,\n      0,\n      magnifierCanvasRef.current.width,\n      magnifierCanvasRef.current.height\n    )\n  }\n\n  useEffect(() => {\n    if (onChange) {\n      onChange({ ...cropPoints, loading })\n    }\n  }, [cropPoints, loading])\n\n  useEffect(() => {\n    const bootstrap = async () => {\n      const src = await readFile(image)\n      await createCanvas(src)\n      showPreview()\n      detectContours()\n      setLoading(false)\n    }\n\n    if (image && previewCanvasRef.current && cvLoaded && mode === 'crop') {\n      bootstrap()\n    } else {\n      setLoading(true)\n    }\n  }, [image, previewCanvasRef.current, cvLoaded, mode])\n\n  const onDrag = useCallback((position, area) => {\n    const { x, y } = position\n\n    const magnCtx = magnifierCanvasRef.current.getContext('2d')\n    clearMagnifier()\n\n    // TODO we should make those 5, 10 and 20 values proportionate\n    // to the point size\n    magnCtx.drawImage(\n      previewCanvasRef.current,\n      x - (pointSize - 10),\n      y - (pointSize - 10),\n      pointSize + 5,\n      pointSize + 5,\n      x + 10,\n      y - 90,\n      pointSize + 20,\n      pointSize + 20\n    )\n\n    setCropPoints((cPs) => ({ ...cPs, [area]: { x, y } }))\n  }, [])\n\n  const onStop = useCallback((position, area, cropPoints) => {\n    const { x, y } = position\n    clearMagnifier()\n    setCropPoints((cPs) => ({ ...cPs, [area]: { x, y } }))\n    if (onDragStop) {\n      onDragStop({ ...cropPoints, [area]: { x, y } })\n    }\n  }, [])\n\n  return (\n    <div\n      style={{\n        position: 'relative',\n        ...(previewDims && buildImgContainerStyle(previewDims))\n      }}\n    >\n      {previewDims && mode === 'crop' && cropPoints && (\n        <Fragment>\n          <CropPoints\n            pointSize={pointSize}\n            pointBgColor={pointBgColor}\n            pointBorder={pointBorder}\n            cropPoints={cropPoints}\n            previewDims={previewDims}\n            onDrag={onDrag}\n            onStop={onStop}\n            bounds={{\n              left: previewCanvasRef?.current?.offsetLeft - pointSize / 2,\n              top: previewCanvasRef?.current?.offsetTop - pointSize / 2,\n              right:\n                previewCanvasRef?.current?.offsetLeft -\n                pointSize / 2 +\n                previewCanvasRef?.current?.offsetWidth,\n              bottom:\n                previewCanvasRef?.current?.offsetTop -\n                pointSize / 2 +\n                previewCanvasRef?.current?.offsetHeight\n            }}\n          />\n          <CropPointsDelimiters\n            previewDims={previewDims}\n            cropPoints={cropPoints}\n            lineWidth={lineWidth}\n            lineColor={lineColor}\n            pointSize={pointSize}\n          />\n          <canvas\n            style={{\n              position: 'absolute',\n              zIndex: 5,\n              pointerEvents: 'none'\n            }}\n            width={previewDims.width}\n            height={previewDims.height}\n            ref={magnifierCanvasRef}\n          />\n        </Fragment>\n      )}\n\n      <canvas\n        style={{ zIndex: 5, pointerEvents: 'none' }}\n        ref={previewCanvasRef}\n      />\n    </div>\n  )\n}\n\nexport default Canvas\n\nCanvas.propTypes = {\n  image: T.object.isRequired,\n  onDragStop: T.func,\n  onChange: T.func,\n  cropperRef: T.shape({\n    current: T.shape({\n      done: T.func.isRequired,\n      backToCrop: T.func.isRequired\n    })\n  }),\n  pointSize: T.number,\n  lineWidth: T.number,\n  pointBgColor: T.string,\n  pointBorder: T.string,\n  lineColor: T.string\n}\n","import React from 'react'\nimport { OpenCvProvider } from 'opencv-react'\nimport Canvas from '../lib/Canvas'\nimport T from 'prop-types'\n\nconst Cropper = React.forwardRef((props, ref) => {\n  if (!props.image) {\n    return null\n  }\n\n  return (\n    <OpenCvProvider openCvPath={props.openCvPath}>\n      <Canvas {...props} cropperRef={ref} />\n    </OpenCvProvider>\n  )\n})\n\nexport default Cropper\n\nCropper.propTypes = {\n  openCvPath: T.string\n}\n"],"names":["readFile","file","File","Promise","resolve","reject","reader","FileReader","onload","event","result","onerror","err","readAsDataURL","calcDims","width","height","externalMaxWidth","externalMaxHeight","ratio","maxWidth","window","innerWidth","maxHeight","innerHeight","calculated","Math","round","buildCropPointStyle","size","pointBgColor","pointBorder","backgroundColor","border","borderRadius","position","zIndex","CropPoint","cropPoints","pointArea","defaultPosition","pointSize","externalOnStop","onStop","externalOnDrag","onDrag","bounds","useCallback","_","x","y","propTypes","T","shape","number","isRequired","oneOf","string","func","CropPoints","props","previewDims","otherProps","transform","cv","docCanvas","imageResizeRatio","setPreviewPaneDimensions","dst","imread","bR","bL","tR","tL","sourceCoordinates","map","point","max","destCoordinates","Ms","matFromArray","CV_32FC2","concat","Md","transformMatrix","getPerspectiveTransform","dsize","Size","warpPerspective","INTER_LINEAR","BORDER_CONSTANT","Scalar","imshow","applyFilter","filterCvParams","options","blur","th","thMode","ADAPTIVE_THRESH_MEAN_C","thMeanCorrection","thBlockSize","thMax","grayScale","cvtColor","COLOR_RGBA2GRAY","ksize","GaussianBlur","BORDER_DEFAULT","adaptiveThreshold","THRESH_BINARY","convertTo","threshold","CropPointsDelimiters","lineWidth","lineColor","canvas","useRef","clearCanvas","ctx","current","getContext","clearRect","sortPoints","sortOrder","reduce","acc","pointPos","drawShape","point1","point2","point3","point4","strokeStyle","beginPath","moveTo","lineTo","closePath","stroke","useEffect","sortedPoints","buildImgContainerStyle","imageDimensions","Canvas","image","onDragStop","onChange","cropperRef","useOpenCv","cvLoaded","loaded","canvasRef","previewCanvasRef","magnifierCanvasRef","useState","setPreviewDims","setCropPoints","loading","setLoading","mode","setMode","useImperativeHandle","backToCrop","done","opts","preview","toBlob","blob","name","type","showPreview","newPreviewDims","createCanvas","src","img","document","createElement","drawImage","Mat","resize","INTER_AREA","detectContours","Canny","contours","MatVector","hierarchy","findContours","RETR_CCOMP","CHAIN_APPROX_SIMPLE","rect","boundingRect","Object","keys","forEach","key","contourCoordinates","clearMagnifier","magnCtx","bootstrap","area","cPs","left","offsetLeft","top","offsetTop","right","offsetWidth","bottom","offsetHeight","pointerEvents","object","Cropper","React","forwardRef","ref","openCvPath"],"mappings":"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"}